<!--suppress HtmlFormInputWithoutLabel -->
<ng-container>
    <div>
        <div *ngIf="isEditFormViewActive || selectedProject" class="card card-body top-margin-medium">
            <ng-container *ngTemplateOutlet="form"></ng-container>
        </div>
        <div class="project-list" *ngIf="!isEditFormViewActive">
            <div class="bottom-margin-medium top-margin-medium">
                <div class="mx-0 row justify-content-between">
                    <h2 class="bottom-margin-small">Viimane nädal</h2>
                    <button
                            class="btn primary"
                            *ngIf="!isEditFormViewActive && !selectedProject && (auth.user.role === 'ADMIN' || auth.user.role === 'BOARD')"
                            (click)="toggleEditProjectForm()"
                    >
                        Uus projekt
                    </button>
                </div>
                <div class="flex-row">
                    <app-project-card *ngFor="let project of projectDateMap.thisWeek" [project]="project"></app-project-card>
                </div>
            </div>

            <div class="bottom-margin-medium">
                <h2 class="bottom-margin-small">Käesolev kuu</h2>
                <div class="flex-row">
                    <app-project-card *ngFor="let project of projectDateMap.thisMonth" [project]="project"></app-project-card>
                </div>
            </div>

            <div class="bottom-margin-medium">
                <h2 class="bottom-margin-small">Vanemad projektid</h2>
                <div class="flex-row">
                    <app-project-card *ngFor="let project of projectDateMap.other" [project]="project"></app-project-card>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<ng-template #form>
    <form [formGroup]="editProjectForm" (ngSubmit)="onSubmit()" class="material-form">
        <h3>Üldine</h3>
        <div class="flex-row">
            <mat-form-field appearance="outline" class="flex-item">
                <mat-label>Projekti nimi</mat-label>
                <input matInput formControlName="title" required>
            </mat-form-field>
            <app-user-select
                    class="flex-item"
                    [form]="editProjectForm"
                    controlName="projectLead"
                    label="Projektijuht"
                    required=true
                    appearance="outline">
            </app-user-select>
        </div>

        <mat-slide-toggle formControlName="multiDayEvent" class="bottom-margin-small">Mitme-päevane projekt</mat-slide-toggle>
        <div class="flex-row">
            <mat-form-field class="flex-item" appearance="outline">
                <mat-label>{{!editProjectForm.controls['multiDayEvent'].value ? 'Kuupäev' : 'Alguskuupäev'}}</mat-label>
                <input matInput [matDatepicker]="startDatePicker" formControlName="dateStart" required>
                <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #startDatePicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field *ngIf="editProjectForm.controls['multiDayEvent'].value" class="flex-item" appearance="outline">
                <mat-label>Lõppkuupäev</mat-label>
                <input matInput [matDatepicker]="endDatePicker" [min]="editProjectForm.controls['dateStart'].value" formControlName="dateEnd">
                <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #endDatePicker></mat-datepicker>
            </mat-form-field>
        </div>

        <h3>Meeskond</h3>

        <h3>Kokkuvõte</h3>
        <mat-form-field appearance="outline">
            <mat-label>Projekti kirjeldus</mat-label>
            <textarea matInput formControlName="description" required></textarea>
        </mat-form-field>
        <mat-form-field appearance="outline">
            <mat-label>Mis läks hästi?</mat-label>
            <textarea matInput #positiveSummary maxlength="300"
                      formControlName="positiveSummary"></textarea>
            <mat-hint align="end">{{positiveSummary.value.length}} / 300</mat-hint>
        </mat-form-field>
        <mat-form-field appearance="outline">
            <mat-label>Mis oleks võinud paremini olla?</mat-label>
            <textarea matInput #negativeSummary maxlength="300"
                      formControlName="negativeSummary"></textarea>
            <mat-hint align="end">{{negativeSummary.value.length}} / 300</mat-hint>
        </mat-form-field>

        <h3>Eelarve</h3>

        <div class="budget">
            <div formArrayName="budgetRows" *ngFor="let budgetRow of budgetRows.controls; let i = index;">
                <div [formGroupName]="i" class="flex-row">
                    <mat-form-field class="flex-item">
                        <span matPrefix>{{i + 1}}&nbsp;</span>
                        <mat-label>Kirjeldus</mat-label>
                        <input matInput formControlName="description" required>
                    </mat-form-field>
                    <mat-form-field class="flex-item">
                        <span matPrefix>€&nbsp;</span>
                        <mat-label>Teaduskonna kulu</mat-label>
                        <input matInput formControlName="facultyCost">
                    </mat-form-field>
                    <mat-form-field class="flex-item">
                        <span matPrefix>€&nbsp;</span>
                        <mat-label>ITÜKi kulu</mat-label>
                        <input matInput formControlName="itukCost">
                    </mat-form-field>
                </div>
            </div>
            <input type="button" (click)="addBudgetRow()" class="btn btn-outline-success" value="Uus rida">
        </div>

        <div class="btn-group float-right top-margin-medium" role="group" aria-label="Basic example">
            <button type="submit" class="btn primary">Salvesta</button>
            <button type="button" class="btn btn-outline-primary" (click)="hideFrom()">Tühista</button>
        </div>
    </form>
</ng-template>
